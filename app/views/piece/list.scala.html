@(username: String, pieces: List[PieceOverview])(implicit flash: Flash, token: play.filters.csrf.CSRF.Token)

@import helper._
@import b3.inline.fieldConstructor

@main(Some(Html("My Contributions")), nav = "My Contributions", Some(username)) {
	<script>
		$(document).ready(function() {
			fadeOutAlerts(2000); //2 sec
		});
	</script>
	@flash.get("success").map { message =>
				<div class="alert alert-dismissable alert-success">
					<button type="button" class="close" data-dismiss="alert">Ã—</button>
					@message
				</div>
	}
	<div class="panel panel-default">
  		<div class="panel-heading">
    		<h3 class="panel-title">You have @pieces.size @if(pieces.size > 1){
    			Contributions } else { Contribution }</h3>
  		</div>
  		<div class="panel-body">
    		<table class="table table-striped table-hover">
		       <thead>
			         <tr>
			         	<th>Title</th>
			         	<th>Short Summary</th>
			         	@if(pieces.exists(_.published.isDefined)){
			         		<th>Published</th>
			         	}
			         	<th>Tags</th>
			         	<th>Rating</th>
			         </tr>
		         </thead>
		         <tbody>
		         	@for(p <- pieces) {
		         		@b3.form(routes.PieceKeeper.overviewAction(p.id)) {
			         		@CSRF.formField
							<tr>
		           				<td>@p.title</td>
		           				@if(p.shortSummary.length > 50){
		           					<td>@p.shortSummary.substring(0, 50) ...</td>
		           				}else{
		           					<td>@p.shortSummary</td>
		           				}
		           				@if(p.tags.size > 0){
									<td>
										@p.tags.mkString(", ")
									</td>
								}	           				
		           				<td>@p.rating</td>
		         				@if(p.published.isDefined){
		         					<td>@p.published</td>
		         				}else {
			         			<td>
				         			 @b3.submit(
										       	'class -> "btn btn-xs btn-success", 
										       	'name -> "action", 
										       	'value ->"publish"){ <span class="glyphicon glyphicon-globe"></span> Publish } 
				         		</td>
			         			}
			         			<td>
			         				@b3.submit(
										       	'class -> "btn btn-xs btn-primary", 
										       	'name -> "action", 
										       	'value ->"edit"){ <span class="glyphicon glyphicon-pencil"></span> Edit } 
				         		</td>
			         			<td>
		         					<button type="button" class="btn btn-xs btn-danger" data-toggle="modal" data-target="#confirmDelete-@p.id">
									  	Delete
									</button>
								</td>
							</tr>
							 
							<div class="modal fade" id="confirmDelete-@p.id" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
							  <div class="modal-dialog">
							    <div class="modal-content">
							      <div class="modal-header">
							        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
							        <h4 class="modal-title" id="myModalLabel">Confirm Action</h4>
							      </div>
							      <div class="modal-body">
							       <p> Are you sure you want to irreversibly <strong>delete</strong> this contribution?</p>
							       <div class="jumbotron">
							       		<h3>@p.title</h3>
							       		<span class="gutter"></span>
							       		<h5>@p.shortSummary</h5>
							       </div>
							      </div>
							      <div class="modal-footer">
							        <div class="modal-controls">
								        @b3.submit(
										       	'class -> "btn btn-danger", 
										       	'name -> "action", 
										       	'value ->"delete"){ <span class="glyphicon glyphicon-trash"></span> Yes } 
									</div>
									<div class="modal-controls">
								      	@b3.free('class -> "clearfix"){
								        	<button type="button" class="btn btn-default" data-dismiss="modal">No</button>
								        }
							        </div>
							      </div>
							    </div>
							  </div>
							</div>
						}
					}
		       </tbody>
			</table>
  		</div>
	</div>

}(false, 100)