@(username: String, pieces: List[PieceOverview])(implicit flash: Flash, token: play.filters.csrf.CSRF.Token)

@import helper._
@import b3.inline.fieldConstructor

@getDate(timestamp: Long) = @{
  new java.util.Date(timestamp)
}

@main(Some(Html("My Posts")), nav = "View Existing", Some(username)) {
	<script>
		$(document).ready(function() {
			fadeOutAlerts(2000); //2 sec
			$(function () {
				  $('[data-toggle="tooltip"]').tooltip()
				}) //init tooltips
		});
	</script>
	@flash.get("success").map { message =>
				<div class="alert alert-dismissable alert-success">
					<button type="button" class="close" data-dismiss="alert">Ã—</button>
					@message
				</div>
	}
	<div class="panel panel-default">
  		<div class="panel-heading">
    		<h3 class="panel-title">You have @pieces.size @if(pieces.size > 1){
    			posts } else { post }</h3>
  		</div>
  		<div class="panel-body">
    		<table class="table table-striped table-hover">
		       <thead>
			         <tr>
			         	<th>Title</th>
			         	<th>Short Summary</th>
			         	<th>Tags</th>
			         	<th>Rating</th>
			         	@if(pieces.exists(_.published.isDefined)){
			         		<th>Published</th>
			         	}
			         	<th colspan=3>Actions</th>
			         </tr>
		         </thead>
		         <tbody>
		         	@for(p <- pieces.sortBy(_.title) ) {
		         		@b3.form(routes.PieceKeeper.overviewAction(p.id)) {
			         		@CSRF.formField
							<tr>
		           				<td>
		           					@if(p.published.isDefined){<span class="glyphicon glyphicon-pushpin published"></span>}
		           					@p.title
		           				</td>
		           				@if(p.shortSummary.length > 100){
		           					<td>@p.shortSummary.substring(0, 100) ...</td>
		           				}else{
		           					<td>@p.shortSummary</td>
		           				}
		           				@if(p.tags.size > 0){
									<td>
										@for(t <- p.tags){
											<span class="hashtag">@t</span>
										}
									</td>
								}	           				
		           				<td>@p.rating</td>
		         				@if(p.published.isDefined){
		         					<td>
		         						@getDate(p.published.get)
	         						</td>
	         						<td>
					         			 <div class="form-group">
						         			 <button type="submit" class="btn btn-xs btn-default" name="action" value="unpublish" data-toggle="tooltip" 
						         			 	data-placement="left" title="Take It Offline"> 
						         			 	<span class="glyphicon glyphicon-globe"></span> 
						         			 </button> 
					         			 </div>
	         						
		         				} else {
	         						<td>n/a</td>
				         			<td>
				         			<div class="form-group">
						         			 <button type="submit" class="btn btn-xs btn-success" name="action" value="publish" data-toggle="tooltip" 
						         			 data-placement="left" title="Publish"> 
						         			 	<span class="glyphicon glyphicon-globe"></span> 
						         			 </button> 
					         		</div>
				         	}
			         				<div class="form-group">
						         			 <button type="submit" class="btn btn-xs btn-primary" name="action" value="edit" data-toggle="tooltip" 
						         			 data-placement="left" title="Edit"> 
						         			 	<span class="glyphicon glyphicon-pencil"></span> 
						         			 </button> 
					         		</div>
						         		<span data-toggle="modal" data-target="#confirmDelete-@p.id">
				         					<button type="button" class="btn btn-xs btn-danger" class="btn btn-xs btn-primary" name="action" value="edit" data-toggle="tooltip" 
								         			 data-placement="left" title="Delete">
											  <span class="glyphicon glyphicon-trash"></span>
											</button>
										</span>
									</td>
							</tr>
							 
							<div class="modal fade" id="confirmDelete-@p.id" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
							  <div class="modal-dialog">
							    <div class="modal-content">
							      <div class="modal-header">
							        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
							        <h4 class="modal-title" id="myModalLabel">Confirm Action</h4>
							      </div>
							      <div class="modal-body">
							       <p> Are you sure you want to irreversibly <strong>delete</strong> this contribution?</p>
							       <div class="jumbotron">
							       		<h3>@p.title</h3>
							       		<span class="gutter"></span>
							       		<h5>@p.shortSummary</h5>
							       </div>
							      </div>
							      <div class="modal-footer">
							        <div class="modal-controls">
								        @b3.submit(
										       	'class -> "btn btn-danger", 
										       	'name -> "action", 
										       	'value ->"delete"){ <span class="glyphicon glyphicon-trash"></span> Yes } 
									</div>
									<div class="modal-controls">
								      	@b3.free('class -> "clearfix"){
								        	<button type="button" class="btn btn-default" data-dismiss="modal">No</button>
								        }
							        </div>
							      </div>
							    </div>
							  </div>
							</div>
						}
					}
		       </tbody>
			</table>
  		</div>
	</div>

}(false, 100)